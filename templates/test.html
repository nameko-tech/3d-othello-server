<!DOCTYPE html>
<html>
  <head>
    <title>Flask-SocketIO Test</title>
    <script
      src="//code.jquery.com/jquery-1.12.4.min.js"
      integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
    <script type="text/javascript" charset="utf-8">
      $(document).ready(function () {
        // Connect to the Socket.IO server.
        // The connection URL has the following format, relative to the current page:
        //     http[s]://<domain>:<port>[/<namespace>]
        // var socket = io(namespace);
        var socket = io();

        // Event handler for new connections.
        // The callback function is invoked when a connection with the
        // server is established.
        socket.on("connect", function () {
          socket.emit("my_event", { data: "I'm connected!" });
        });

        // Event handler for server sent data.
        // The callback function is invoked whenever the server emits data
        // to the client. The data is then displayed in the "Received"
        // section of the page.
        socket.on("my_response", function (msg, cb) {
          $("#log").prepend(
            "<br>" +
              $("<div/>")
                .text("Received #" + msg.count + ": " + msg.data)
                .html()
          );
          if (cb) cb();
        });

        // Handlers for the different forms in the page.
        // These accept data from the user and send it to the server in a
        // variety of ways
        $("form#emit").submit(function (event) {
          socket.emit("my_event", { data: $("#emit_data").val() });
          return false;
        });
        $("form#broadcast").submit(function (event) {
          socket.emit("my_broadcast_event", {
            data: $("#broadcast_data").val(),
          });
          return false;
        });
      });
    </script>
  </head>
  <body>
    <h1>Flask-SocketIO Test</h1>
    <p>Async mode is: <b>{{ async_mode }}</b></p>

    <h2>Send:</h2>
    <form id="emit" method="POST" action="#">
      <input
        type="text"
        name="emit_data"
        id="emit_data"
        placeholder="Message"
      />
      <input type="submit" value="Echo" />
    </form>
    <form id="broadcast" method="POST" action="#">
      <input
        type="text"
        name="broadcast_data"
        id="broadcast_data"
        placeholder="Message"
      />
      <input type="submit" value="Broadcast" />
    </form>

    <h2>Receive:</h2>
    <div id="log"></div>
  </body>
</html>
